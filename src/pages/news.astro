---
import Layout from '../layouts/Layout.astro';
import NewsGrid from '../components/NewsGrid';
import NewsHeader from '../components/NewsHeader';
import { Client } from 'pg';

let articles = [];

try {
    const client = new Client({ connectionString: import.meta.env.DATABASE_URL });
    await client.connect();
    // Fetch latest 50 articles
    const res = await client.query(`
        SELECT * FROM news_articles 
        WHERE published_at >= '2025-11-01'
        ORDER BY published_at DESC 
        LIMIT 50
    `);
    articles = res.rows;
    await client.end();
} catch (e) {
    console.error("Failed to fetch news:", e);
}
---

<Layout title="Nipah News Briefing | NiV-Tracker">
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <NewsHeader client:load />

        <NewsGrid client:load initialArticles={articles} />
    </main>
</Layout>
